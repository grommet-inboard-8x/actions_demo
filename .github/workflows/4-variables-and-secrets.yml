name: Exploring variables and Secrets
on: push

env:
  CONTAINER_REGISTRY: docker.io
  DOCKER_USERNAME: siddharth1
  IMAGE_NAME: github-actions-nginx

jobs:
    docker:
        runs-on: ubuntu-latest
        steps:
            - name: Docker build
              run: docker build -t docker.io/dockerUsername/imageName:latest

            - name: Docker Login
              run: docker login --username=dockerUsername --password=securePassword

            - name: Publish Image
              run: docker push docker.io/dockerUserName/imageName:latest

    deploy: 
        needs: docker
        runs-on: ubuntu-latest
        steps:
            - name: Docker run
              run: docker run -d -p 8000:80 docker.io/dockerUsername/imageName:latest

# Step level Environment variables
            - name: Build with env
              env:
                CONTAINER_REGISTRY: docker.io
                DOCKER_USERNAME: kalyan
                IMAGE_NAME: github-actions-nginx
              run: |
                docker build -t $CONTAINER_REGISTRY/$DOCKER_USERNAME/$IMAGE_NAME:latest


# You can reference environment variables in two ways inside run blocks
# Shell syntax - $DOCKER_USERNAME
# GitHub Actions expression - $\{{ env.DOCKER_USERNAME }}
# Both methods are supported; choose based on readability.

# Job-Level Environment Variables
# Move shared variables to the job level so all steps inherit them:

    docker_job_vars:
        env:
            CONTAINER_REGISTRY: docker.io
            DOCKER_USERNAME: siddharth1
            IMAGE_NAME: github-actions-nginx
        runs-on: ubuntu-latest
        steps:
            - name: Docker build
              run: docker build -t $CONTAINER_REGISTRY/$DOCKER_USERNAME/$IMAGE_NAME:latest

            - name: Docker Login
              env:
                DOCKER_PASSWORD: s3CuRePa$s$w0rd
              run: |
                docker login --username=$DOCKER_USERNAME --password=$DOCKER_PASSWORD

            - name: Docker Publish
              run: |
                docker push $CONTAINER_REGISTRY/$DOCKER_USERNAME/$IMAGE_NAME:latest

# Step-specific env values (like DOCKER_PASSWORD) override or extend the job-level settings.

# Workflow-Level Environment Variables
# Set env at the workflow root so all jobs inherit the same defaults:

# GitHub Actions provides a secure mechanism to inject encrypted values at runtime:
# Secrets for sensitive data (passwords, tokens).
# Variables for non-sensitive settings (usernames, tags).

# â€‹Scopes of Secrets and Variables


# Organization - Shared across multiple repositories Visibility -	Only Org Admins
# Repository - Shared by all workflows in a single repo	Visibility - Write access to Settings
# Environment	Limited to specific deployment environments Visibility - Environment admins and selected roles

# Adding a Repository-Level Secret
# Navigate to Settings > Secrets and variables > Actions.
# Click New repository secret, set the Name (e.g., DOCKER_PASSWORD), and paste your secret.
# Click Add secret to save.
# Repository secrets are encrypted and cannot be viewed once saved. If you lose the value, you must recreate the secret.

# Adding a Repository-Level Variable
# Under Settings > Secrets and variables > Actions, select New repository variable.

# Referencing Repository-Level Secrets and variables

#      - name: Docker Login
#        run: |
#          echo docker login \
#            --username=${{ vars.DOCKER_USERNAME }} \
#            --password=${{ secrets.DOCKER_PASSWORD }}